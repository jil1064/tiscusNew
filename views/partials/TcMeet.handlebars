<link href="/css/TcMeet.css" rel="stylesheet">
<link href="/css/fidella7.css" rel="stylesheet">

<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<!--
<div class='meetPage page leftPage text'>
    <div class='genBar'>
        <button><img class='icon' id='back' src='img/back.png'></button>
        <button id='createMeet'>+</button>
    </div> 
    <div class='info' style='text-align: center; padding: 0;'>

        <button data-toggle="modal" data-target="#waitModal">
            <div class="meetCard waiting" style='border-color: #e6e6e6;'><span style="font-family: 'Arial';">Bible Study</span><br>
            waiting for 5 response(s)</div>
        </button>

        <button><div class="meetCard done"><span style="font-family: 'Arial';">9/21 - SCF meeting</span><br>
            @Someone's apt<br>
            Sat 7:00pm-8:00pm</div></button>
    </div>  
</div>    

<div class='createMeetPage page leftPage text'>
    <div class='genBar'>
        <button><img class='icon' id='back' src='img/back.png'></button>
    </div> 
    <div class='info meetStep1'>
        <input id='tcSearch' type='search' placeholder='who? group/user(s)' style='position: absolute; width: 80%;'>
              {{#each possibleriends}}
            <div id="searchResult" style="display: none;" data-toggle="modal" data-target="#fakeAdd">
                <img class="friendPhoto" src="img/friendProfile.png">
                <a class="friendText">{{name}}</a>
                <a class="addFriendButton">
                <img class="addIcon" src="img/addFriendBefore.svg">
                </a>
            </div>
            {{/each}}
        <br><br>
        <div id='resultInfo' style='display: none;'>
            <a href='#' class="user_list" id="user1"><img class='profilePicMeet' src='img/profile.png'></a>
            <a href='#' class="user_list" id="user2"><img class='profilePicMeet' src='img/profile.png'></a>
            <div class='meetGroups'>
                <button class='meetGroupCard'>UCSD SCF</button>
                <button class='meetGroupCard'>DSGN 1 Proj#1</button>
            </div>
        </div>
        <br>
        <div style='text-align: center;'>
            <p><button id='addToGroup'>add to the group</button></p>
            <button id='createGroup'>create a new group</button>
            <p><input id='newGroupName' type='text' placeholder="the new group's name"></p>
            <p><button id='submitGroup' style='display: none;'>submit</button></p>
            <button><img class='icon' id='meetNext' src='img/next.png'></button>
        </div>
    </div>  
    <div class='info meetStep2' style='display: none;'>
        <br>
        <form id='tcForm'>
        <input id="tcTitle" type='text' placeholder='Event Title'>
        <br>
        <input id="tcNotes" type='text' placeholder='notes (optional)'>
        <br>
        <input id="tcDuration" type='number' placeholder='how many minutes?'>
        <br><br>
        <p>Date Range (optional)
            <br><input type='date' onfocus="(this.type='date')" onblur="(this.type='text')" placeholder='06/27/2019'>
            <br>to
            <br><input type='date' onfocus="(this.type='date')" onblur="(this.type='text')" placeholder='07/27/2019'>
        </p><br>
        <p>Time Range (optional)
            <br><input type='time' onfocus="(this.type='time')" onblur="(this.type='text')" placeholder='9:00 AM'>
            <br>to
            <br><input type='time' onfocus="(this.type='time')" onblur="(this.type='text')" placeholder='9:00 PM'>
        </p>                       
        <br><br>
        <div style='text-align: center;'>
            <button id='sendInvi' type='submit'>Tc Them!</button>
        </div>
        </form>
    </div>            
</div> 
-->

<div class='selectPage page leftPage text' style="display: inline-block;">
      <div class='genBar'>
          <button><img class='icon' id='back' src='img/back.png'></button>
          <p class="newEventLabel">New Event</p>
          <!--<button id='createMeet'>+</button>-->
      </div>
      <div class='info'>
        <div class="wrapper">
          <div class="ppt" style="display: none">

          </div>
          <div class="border" style="display: none">
          </div>
          <table class="ppt_table">
              <thead class="ppt_thead">
                <tr>
                  <th><input type="text" id="search" placeholder="Schedule with:" onkeyup="searchPpt()"></th>
                </tr>
              </thead>
              <tbody class="ppt_tbody">
                <tr>
                  <td><img class="group_img" src="img/groupImg.png">Study Group
                  </td>
                </tr>
                <tr>
                  <td><span class="table_circle">CL</span>Crystal Lu
                  </td>
                </tr>
                <tr>
                  <td><span class="table_circle">JB</span>James Bieber
                  </td>
                </tr>
                <tr>
                  <td><span class="table_circle">AK</span>Amy Kenn
                  </td>
                </tr>
                <tr>
                  <td><span class="table_circle">JB</span>James Bieber
                  </td>
                </tr>
                <tr>
                  <td><span class="table_circle">CL</span>Crystal Lu
                  </td>
                </tr>
              </tbody>
            </table><br><br>
        <div class="btn_styling">
            <button class="create_button">Create a Group</button>
            <button class="next_btn" id="select_next" disabled>Next</button>
        </div>
    </div>
    </div>
  </div>



<div class='tmConfirm page leftPage text' style="display: none;">
  <div class='genBar' style="clear: both;">
      <button><img class='icon' id='back' src='img/back.png'></button>
      <a class="cancelLabel">Cancel</a>
      <p class="newEventLabel">New Event</p>
  </div>
  <div class="info">
    <p id="ppt_lbl">Participants</p>
    <div class="confirm_ppt">
        <!--<div class="circle">JB</div>
        <div class="circle">CL</div>
        <div class="circle">CL</div>
        <div class="circle">CL</div>
        <div class="circle">CL</div>-->
    </div>
    <form id="questions" oninput="validate()">
      Event Title*<br>
      <input type="text" id="event_title" name="event"><br>
      How long would you like to meet?*<br>
      <div class="time_select">
        <select name="hr" id="hr">
          <option style="display:none;"></option>
          <option value="0">0</option>
          <option value="1">1</option>
          <option value="2">2</option>
          <option value="3">3</option>
        </select>
        <label for="hr" class="time_label">Hr&nbsp;</label>
        <select name="min" id="min">
          <option style="display:none;"></option>
          <option value="00">00</option>
          <option value="15">15</option>
          <option value="30">30</option>
          <option value="45">45</option>
        </select>
        <label for="min" class="time_label">Min</label><br>
      </div>
      Any constraint?* (3-day default)<br>
      <div class="choose_date">
        <input type="text" id="first_date" name="first_date" placeholder="m/d/yyyy" readonly>
        <p style="display: inline;"> - </p>
        <input type="text" id="second_date" placeholder="m/d/yyyy" readonly>
      </div>
      Notes<br>
      <!-- <input type="text" id="notes" name="notes"><br> -->
      <textarea type="text" id="notes" name="notes" maxlength="20"></textarea><br> <!--about 26 per line, so 50ish-->
      <!-- <div id="notes" name="notes" contentEditable="true" maxlength="5"></div> -->
      <div class="subm">
        <input type="submit" id="submit" value="Send Invites">
      </div>
    </form>
  </div>
</div>


<div class='createMeetPage page leftPage text'>
    <div class='genBar'>
        <button><img class='icon' id='back' src='img/back.png'></button>
    </div>
    <div class='info meetStep1'>
        <input id='tcSearch' type='search' placeholder='who? group/user(s)' style='position: absolute; width: 80%;'>
        <div id='searchResult'><br>search result<br>(Imagine you have clicked 2 users and 2 groups)</div>
        <br><br>
        <div id='resultInfo' style='display: none;'>
            <a href='#'><img class='profilePicMeet' src='img/profile.png'></a>
            <a href='#'><img class='profilePicMeet' src='img/profile.png'></a>
            <div class='meetGroups'>
                <button class='meetGroupCard'>UCSD SCF</button>
                <button class='meetGroupCard'>DSGN 1 Proj#1</button>
            </div>
        </div>
        <br>
        <div style='text-align: center;'>
            <button id='createGroup'>create a new group</button>
            <p><input id='newGroupName' type='text' placeholder="the new group's name"></p>
            <p><button id='submitGroup' style='display: none;'>submit</button></p>
            <button><img class='icon' id='meetNext' src='img/next.png'></button>
        </div>
    </div>
    <div class='info meetStep2' style='display: none;'>
        <br>
        <input type='text' placeholder='Event Title'>
        <br>
        <input type='text' placeholder='notes (optional)'>
        <br>
        <input type='number' placeholder='how many minutes?'>
        <br><br>
        <p>Date Range (optional)
            <br><input type='date' onfocus="(this.type='date')" onblur="(this.type='text')" placeholder='06/27/2019'>
            <br>to
            <br><input type='date' onfocus="(this.type='date')" onblur="(this.type='text')" placeholder='07/27/2019'>
        </p><br>
        <p>Time Range (optional)
            <br><input type='time' onfocus="(this.type='time')" onblur="(this.type='text')" placeholder='9:00 AM'>
            <br>to
            <br><input type='time' onfocus="(this.type='time')" onblur="(this.type='text')" placeholder='9:00 PM'>
        </p>
        <br><br>
        <div style='text-align: center;'>
            <button id='sendInvi'>Tc Them!</button>
        </div>
    </div>
</div>


<script src="public/js/messy.js"></script>

<script>

var initial = "";
var fullname;
var count = "";

function mobile_show4() { /*when count != 0*/
  $('tbody').css("height", "calc(6.6vh * 5 + 4px)");
  $('tbody').css("max-height", "calc(11vw * 4.1)");
  $('table').css("margin-top","3.5vw");
}
function mobile_show5() { /*when count = 0*/
  $('tbody').css("height", "calc(6.6vh * 5)");
  $('tbody').css("max-height", "calc(11vw * 5)");
}
function desktop_show4() { /*when count != 0*/
  $('tbody').css("height","calc((2.2vw + 6px) * 4 + 1px)");
  $('table').css("margin-top","0.8vw");
}
function desktop_show5() { /*when count = 0*/
  $('tbody').css("height","calc((2.2vw + 6px) * 5)");
}

$(window).on('resize', function(e) {
  console.log('true');
  $('#datepicker').datepicker('hide');
  //for phone
  if (window.matchMedia('(max-width: 480px)').matches) {
    if (count != 0) { //determines how many rows to show
      mobile_show4();
    }
    else{
      mobile_show5();
    }
  }
  //for desktop
  else{
    if (count != 0) {
      desktop_show4();
    }
    else{
      desktop_show5();
    }
  }

});


$('tbody').on('click', 'tr', function(){
  $('.ppt').show();
  $('.border').show();

  $(this).find("td").each(function(){

    count = $('.ppt .circle:visible').length + 1;
    console.log(count);

    initial = $(this).closest('tr').find('.table_circle').text();
    console.log(initial);

    var get_name = $(this).closest('tr').find('td').text();
    //get_name.replace('\n', '');
    get_name = get_name.substring(2);
    //console.log(get_name);
    get_name = get_name.split(' ')
    //get_name = get_name.split('\n');
    //console.log(get_name);
    fullname = get_name[0] + " " + get_name[1] + " ";
    console.log(fullname);


    if (count != 0) { //show 4 rows when there's participants
      console.log('here1');
      $(".next_btn").prop( "disabled", false );
      $(".next_btn").addClass("next_btn_enabled");
      //4 rows for phone
      if (window.matchMedia('(max-width: 480px)').matches) {
        console.log('here2');
        mobile_show4();
      }
      //4 rows for desktop
      else{
        desktop_show4();
      }
    }


    if (count < 5) {
        //this.classList.contains('img')
        //console.log($(this).children().hasClass("table_circle"));
        $(this).hide();
        if ($(this).children().hasClass("table_circle")) {
          console.log("ppt clicked");
          var addHTML = "<div class='circle' style='font-weight: 500'>" + initial + " </div>";
          var circles = $(addHTML).text(initial);
          circles.append("<div class='minus'>-</div>")
          $(".selectPage .ppt").append(circles);
          //$(".tmConfirm .ppt").append(circles);
          console.log(fullname);
          circles.attr('id', fullname);
          console.log(count);
        }
        else{
          console.log("group clicked");

        }
    }
    else{
      alert("Max number of participants is 6");
    }


  });
});


$('.ppt').on('click', '.minus', function(){
    //alert("minus clicked");
    count--;
    console.log(count);
    //when no participants, hide border and make button disabled
    if (count == 0) {
      console.log("minus");
      $(".next_btn").prop("disabled", true);
      $(".next_btn").removeClass("next_btn_enabled");

      $('.border').remove()
      $('table').css("margin-top","0");
      //for phones
      if (window.matchMedia('(max-width: 480px)').matches) {
        mobile_show5();
      }
      //for desktop/ipad
      else{
        desktop_show5();
      }
    }

    //console.log(this);
    //hide the circle if minus is clicked
    var closest_circle = $(this).closest('.circle');
    $(closest_circle).remove();
    //console.log(closest_circle.text());

    //get person's name and initial to add it back to the table row
    var minus_initial = closest_circle.text().substring(0,2);
    var minus_name = $(closest_circle).attr('id');
    //console.log(minus_name);

    //add the participant back into the table
    var addRow ="<tr><td><span class='table_circle'>" + minus_initial + "</span>" + minus_name + "</td></tr>"
    $("tbody").append(addRow);
    console.log(minus_name + ":" + minus_initial);

});

  $("#select_next").click(function(){
      $('.selectPage .ppt').clone().appendTo('.tmConfirm .confirm_ppt');
      $('.confirm_ppt').css("padding-top", "0.5vw");
      $('.confirm_ppt .minus').remove();
  });

  //searching JS
  function searchPpt() {
    //user input value
    var input = document.getElementById('search').value;
    input = input.toLowerCase();
    console.log(input);
    //gets all "tr's"
    var tr = document.getElementsByTagName("tr");
    console.log(tr);
    //tr[0] = schedule with input box, so start at 1
    for (i = 1; i < tr.length; i++) {
      //no space btwn initial and name
      var pptname1 = tr[i].getElementsByTagName("td");
      pptname1 = ($(pptname1).text()).trim();
      //space btwn initial and name
      var pptname2 = pptname1.substring(0,2) + " " + pptname1.substring(2);
      console.log(pptname2);
      //no spaces at all
      var pptname3 = pptname1.replace(" ", "");
      console.log(pptname3);
      //console.log(pptname1, ":", pptname1.toLowerCase().indexOf(input));
      //search table. -1 = no match
      if (pptname1.toLowerCase().indexOf(input) > -1 ||
        pptname2.toLowerCase().indexOf(input) > -1 ||
        pptname3.toLowerCase().indexOf(input) > -1) {
          console.log("match");
          $(tr[i]).show();
      }
      else{
          console.log("no");
          $(tr[i]).hide();
      }
  }};

  $(document).ready(function() {
     $(function() {
       console.log("datepicker");
       $("#first_date").datepicker();
     });
   });

   $( "#first_date" ).datepicker({
     dateFormat: "m/d/yy",
     changeMonth: true,
     changeYear: true,
   });

   function validate() {
     document.getElementById('submit').style.display = "none";
       console.log(event_title.value);
       var meeting_hr = document.getElementById('hr');
       console.log(meeting_hr.value);
       var meeting_min = document.getElementById('min');
       console.log(meeting_min.value);
       var date = document.getElementById('first_date');
       //console.log(first_date.value);
       //console.log(date.value);
       var start_date = $('#first_date').datepicker().val();
       console.log(start_date);

       //var date = $("#first_date").val();
       //console.log(date);
       /*check for required questions not empty/checked*/
       if (event_title.value != "" && meeting_hr.value != "" && meeting_min.value != "" && first_date.value != "") {
           console.log("in here");
           document.getElementById('submit').style.display = "block";
           //document.getElementById('submit').hidden = false;
       }
       else{
         console.log("else");
         document.getElementById('submit').style.display = "none";
         //document.getElementById('submit').hidden = true;
       }
   }

   $('#first_date').change('input', function() {
    //function calcDate() {
      var start_date = $('#first_date').datepicker('getDate');
      //console.log("s" + start_date);
      var end_date = start_date.setDate(start_date.getDate()+2);
      end_date = new Date(end_date);
      //console.log(end_date);
      //$('#second_date').datepicker('setDate', end_date);
      $('#second_date').val((end_date.getMonth()+1) + "/" + end_date.getDate() + "/" + end_date.getFullYear());

      if (event_title.value != "" && hr.value != "" && min.value != "" && start_date != "") {
          console.log("in here");
          document.getElementById('submit').style.display = "block";
          //document.getElementById('submit').hidden = false;
      }
      else{
        console.log("else");
        document.getElementById('submit').style.display = "none";
        //document.getElementById('submit').hidden = true;
      }
    });

</script>

